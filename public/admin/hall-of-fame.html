<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Hall of Fame - Century Pong</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body class="flex flex-col items-center min-h-screen">
    <div class="page-wrapper max-w-6xl">
        <header class="page-header">
            <h1 class="text-4xl">
                <span class="page-title">Hall of Fame Admin</span>
            </h1>
        </header>

        <!-- Login Section -->
        <div id="login-section" class="bg-black bg-opacity-70 p-6 rounded-lg shadow-xl mb-6">
            <h2 class="text-2xl font-bold text-orange-500 mb-4">Admin Login</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-orange-500 font-bold mb-2">Password</label>
                    <input type="password" id="admin-password" required class="form-input">
                </div>
                <button type="submit" class="nav-button bg-green-600 hover:bg-green-700">Login</button>
            </form>
            <div id="login-message" class="mt-4 text-red-500 hidden"></div>
        </div>

        <!-- Admin Panel (hidden until logged in) -->
        <div id="admin-panel" class="hidden">
            <!-- Add Photo Form -->
            <div class="bg-black bg-opacity-70 p-6 rounded-lg shadow-xl mb-6">
                <h2 class="text-2xl font-bold text-orange-500 mb-4">Add New Photo</h2>
                <form id="add-photo-form" class="space-y-4" enctype="multipart/form-data">
                    <div>
                        <label class="block text-orange-500 font-bold mb-2">Image</label>
                        <input type="file" name="image" id="image-input" accept="image/*" required class="form-input">
                    </div>
                    <div>
                        <label class="block text-orange-500 font-bold mb-2">Caption</label>
                        <input type="text" name="caption" id="caption-input" placeholder="Enter caption..." required class="form-input">
                    </div>
                    <div>
                        <label class="block text-orange-500 font-bold mb-2">Display Order (optional)</label>
                        <input type="number" name="display_order" id="display-order-input" value="0" class="form-input">
                        <p class="text-sm text-gray-400 mt-1">Lower numbers appear first</p>
                    </div>
                    <button type="submit" class="nav-button bg-green-600 hover:bg-green-700">Add Photo</button>
                </form>
                <div id="add-message" class="mt-4 hidden"></div>
            </div>

            <!-- Existing Photos -->
            <div class="bg-black bg-opacity-70 p-6 rounded-lg shadow-xl">
                <h2 class="text-2xl font-bold text-orange-500 mb-4">Manage Photos</h2>
                <div id="photos-list" class="space-y-4">
                    <!-- Photos will be loaded here -->
                </div>
            </div>
        </div>

        <div class="back-button-container">
            <a href="../home.html" class="nav-button">Back to Home</a>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
        <div class="bg-black bg-opacity-95 p-6 rounded-lg max-w-md w-full">
            <h3 class="text-2xl font-bold text-orange-500 mb-4">Edit Photo</h3>
            <form id="edit-photo-form" class="space-y-4" enctype="multipart/form-data">
                <input type="hidden" id="edit-id">
                <div>
                    <label class="block text-orange-500 font-bold mb-2">Image (leave empty to keep current)</label>
                    <input type="file" name="image" id="edit-image-input" accept="image/*" class="form-input">
                </div>
                <div>
                    <label class="block text-orange-500 font-bold mb-2">Caption</label>
                    <input type="text" name="caption" id="edit-caption-input" required class="form-input">
                </div>
                <div>
                    <label class="block text-orange-500 font-bold mb-2">Display Order</label>
                    <input type="number" name="display_order" id="edit-display-order-input" class="form-input">
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="nav-button bg-green-600 hover:bg-green-700 flex-1">Save Changes</button>
                    <button type="button" onclick="closeEditModal()" class="nav-button bg-gray-600 hover:bg-gray-700 flex-1">Cancel</button>
                </div>
            </form>
            <div id="edit-message" class="mt-4 hidden"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- Firebase Config -->
    <script src="../js/firebase-config.js"></script>
    
    <!-- Initialize Firebase -->
    <script>
      firebase.initializeApp(window.firebaseConfig);
      window.db = firebase.firestore();
      window.storage = firebase.storage();
    </script>
    
    <!-- Firebase Service -->
    <script src="../js/firebase-service.js"></script>
    
    <script>
        let isAuthenticated = window.ceepsAPI.isAdminAuthenticated();

        // Check if already authenticated
        if (isAuthenticated) {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            loadPhotos();
        }

        // Login
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            const messageDiv = document.getElementById('login-message');
            
            const result = window.ceepsAPI.adminLogin(password);
            if (result.success) {
                isAuthenticated = true;
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                loadPhotos();
            } else {
                messageDiv.textContent = result.error || 'Invalid password';
                messageDiv.classList.remove('hidden');
            }
        });

        // Add Photo
        document.getElementById('add-photo-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthenticated) {
                alert('Please login first');
                return;
            }
            
            const caption = document.getElementById('add-caption-input').value.trim();
            const displayOrder = parseInt(document.getElementById('add-display-order-input').value) || 0;
            const imageFile = document.getElementById('add-image-input').files[0];
            const messageDiv = document.getElementById('add-message');
            
            if (!imageFile) {
                messageDiv.textContent = 'Error: Please select an image file';
                messageDiv.className = 'mt-4 text-red-500';
                messageDiv.classList.remove('hidden');
                return;
            }
            
            if (!caption) {
                messageDiv.textContent = 'Error: Caption is required';
                messageDiv.className = 'mt-4 text-red-500';
                messageDiv.classList.remove('hidden');
                return;
            }
            
            try {
                await window.ceepsAPI.addHallOfFamePhoto(imageFile, caption, displayOrder);
                
                messageDiv.textContent = 'Photo added successfully!';
                messageDiv.className = 'mt-4 text-green-500';
                e.target.reset();
                loadPhotos();
                messageDiv.classList.remove('hidden');
            } catch (error) {
                messageDiv.textContent = 'Error: ' + error.message;
                messageDiv.className = 'mt-4 text-red-500';
                messageDiv.classList.remove('hidden');
            }
        });

        // Load Photos
        async function loadPhotos() {
            const container = document.getElementById('photos-list');
            try {
                const photos = await window.ceepsAPI.getHallOfFame();
                
                if (photos.length === 0) {
                    container.innerHTML = '<p class="text-orange-500 text-center py-4">No photos yet. Add one above!</p>';
                    return;
                }
                
                container.innerHTML = photos.map(photo => {
                    const imageSrc = photo.image_url || `../images/hall-of-fame/${photo.image_filename || ''}`;
                    return `
                    <div class="bg-black bg-opacity-50 p-4 rounded flex items-center gap-4">
                        <img src="${imageSrc}" alt="${photo.caption}" class="w-24 h-24 object-cover rounded">
                        <div class="flex-1">
                            <p class="text-white font-semibold">${photo.caption}</p>
                            <p class="text-gray-400 text-sm">Order: ${photo.display_order || 0}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openEditModal('${photo.id}', '${photo.caption.replace(/'/g, "\\'")}', ${photo.display_order || 0})" class="nav-button bg-blue-600 hover:bg-blue-700 text-sm px-4 py-2">Edit</button>
                            <button onclick="deletePhoto('${photo.id}')" class="nav-button bg-red-600 hover:bg-red-700 text-sm px-4 py-2">Delete</button>
                        </div>
                    </div>
                `;
                }).join('');
            } catch (error) {
                container.innerHTML = `<p class="text-red-500 text-center py-4">Error loading photos: ${error.message}</p>`;
            }
        }

        // Edit Photo
        function openEditModal(id, caption, displayOrder) {
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-caption-input').value = caption;
            document.getElementById('edit-display-order-input').value = displayOrder;
            document.getElementById('edit-image-input').value = '';
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.getElementById('edit-message').classList.add('hidden');
        }

        document.getElementById('edit-photo-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAuthenticated) {
                alert('Please login first');
                return;
            }
            
            const id = document.getElementById('edit-id').value;
            const caption = document.getElementById('edit-caption-input').value.trim();
            const displayOrder = parseInt(document.getElementById('edit-display-order-input').value) || 0;
            const imageFile = document.getElementById('edit-image-input').files[0];
            const messageDiv = document.getElementById('edit-message');
            
            if (!caption) {
                messageDiv.textContent = 'Error: Caption is required';
                messageDiv.className = 'mt-4 text-red-500';
                messageDiv.classList.remove('hidden');
                return;
            }
            
            try {
                await window.ceepsAPI.updateHallOfFamePhoto(id, caption, displayOrder, imageFile || null);
                
                messageDiv.textContent = 'Photo updated successfully!';
                messageDiv.className = 'mt-4 text-green-500';
                closeEditModal();
                loadPhotos();
                messageDiv.classList.remove('hidden');
            } catch (error) {
                messageDiv.textContent = 'Error: ' + error.message;
                messageDiv.className = 'mt-4 text-red-500';
                messageDiv.classList.remove('hidden');
            }
        });

        // Delete Photo
        async function deletePhoto(id) {
            if (!isAuthenticated) {
                alert('Please login first');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this photo?')) return;
            
            try {
                await window.ceepsAPI.deleteHallOfFamePhoto(id);
                loadPhotos();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
    <script src="../js/random-background.js"></script>
</body>
</html>

